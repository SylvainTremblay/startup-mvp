<?xml version="1.0" encoding="UTF-8"?>   
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
  
  <property name="uuid_function" value="gen_random_uuid()" dbms="postgresql"/>
  
  <changeSet  author="STremblay"  id="changelog-1.0">  
    <!-- Status Ref Table -->
    <createTable  tableName="STATUS_REF">
      <column  name="STATUS_CD"  type="CHAR(1)" />
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_STATUS_CD" unique="true"/>
      </column>
      <column  name="STATUS_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- User Ref Table -->
    <createTable  tableName="USER_TYPE_REF">
      <column  name="USER_TYPE_CD"  type="CHAR(1)" />
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_USER_TYPE_REF_CD" unique="true"/>
      </column>
      <column  name="USER_TYPE_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- State Province Table -->
    <createTable  tableName="STATE_PROV">
      <column  name="STATE_PROV_CD"  type="VARCHAR(2)" />
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_STATE_PROV_CD" unique="true"/>
      </column>
      <column  name="STATE_PROV_NM"  type="VARCHAR(50)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- Country Table -->
    <createTable  tableName="COUNTRY">
      <column  name="COUNTRY_CD"  type="VARCHAR(2)" />
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_COUNTRY_CD" unique="true"/>
      </column>
      <column  name="COUNTRY_NM"  type="VARCHAR(50)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- Customer Table -->
    <createTable  tableName="CUSTOMER">
      <column  name="CUST_ID"  type="UUID" valueComputed="${uuid_function}">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_CUSTOMER_ID" unique="true"/>
      </column>
      <column  name="CUST_NM"  type="VARCHAR(100)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
      <column  name="ADDRESS1"  type="VARCHAR(50)" />
      <column  name="ADDRESS2"  type="VARCHAR(50)" />
      <column  name="CITY"  type="VARCHAR(50)" />
      <column  name="STATE_PROV_CD"  type="VARCHAR(2)">
        <constraints nullable="false" referencedTableName="CUSTOMER" referencedColumnNames="STATE_PROV_CD" foreignKeyName="FK_CUST_STAT_PROV_CD"/>
      </column>
      <column  name="POST_ZIP_CD"  type="VARCHAR(8)" />
      <column  name="COUNTRY_CD"  type="VARCHAR(2)">
        <constraints nullable="false" referencedTableName="COUNTRY" referencedColumnNames="COUNTRY_CD" foreignKeyName="FK_CUST_COUNTRY_CD"/>
      </column>
      <column  name="WEBSITE"  type="VARCHAR(100)" />
      <column  name="STATUS_CD"  type="CHAR(1)">
        <constraints nullable="false" referencedTableName="STATUS_REF" referencedColumnNames="STATUS_CD" foreignKeyName="FK_CUST_STATUS_REF_CD"/>
      </column>
      <column  name="AUDIT_TS"  type="TIMESTAMP" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
    </createTable>
    <!-- User Table -->
    <createTable  tableName="USER">
      <column  name="USER_ID"  type="UUID" valueComputed="${uuid_function}">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_USER_ID" unique="true"/>
      </column>
      <column  name="EMAIL_ADDRESS"  type="VARCHAR(100)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
      <column  name="FIRST_NM"  type="VARCHAR(30)" />
      <column  name="LAST_NM"  type="VARCHAR(30)" />
      <column  name="USER_TYPE_CD"  type="CHAR(1)">
        <constraints nullable="false" referencedTableName="USER_TYPE_REF" referencedColumnNames="USER_TYPE_CD" foreignKeyName="FK_USER_TYPE_REF_CD"/>
      </column>
      <column  name="STATUS_CD"  type="CHAR(1)">
        <constraints nullable="false" referencedTableName="STATUS_REF" referencedColumnNames="STATUS_CD" foreignKeyName="FK_USER_STATUS_REF_CD"/>
      </column>
      <column  name="AUDIT_TS"  type="TIMESTAMP" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
    </createTable>
    <!-- Platform Table -->
    <createTable  tableName="PLATFORM">
      <column  name="PLATFORM_TYPE_CD"  type="CHAR(1)">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_PLATFORM_CD" unique="true"/>
      </column>
      <column  name="PLATFORM_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- Widget Type Table -->
    <createTable  tableName="WIDGET_TYPE">
      <column  name="WIDGET_TYPE_CD"  type="CHAR(2)">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_WIDGET_TYPE" unique="true"/>
      </column>
      <column  name="PLATFORM_TYPE_CD"  type="CHAR(1)">
        <constraints nullable="false" referencedTableName="PLATFORM" referencedColumnNames="PLATFORM_TYPE_CD" foreignKeyName="FK_PLATFORM_TYPE_REF_CD"/>
      </column>
      <column  name="WIDGET_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- Widget Type Action Table -->
    <createTable  tableName="WIDGET_TYPE_ACTION">
      <column  name="WIDGET_TYPE_ACTION_CD"  type="CHAR(2)">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_WIDGET_TYPE_ACTION" unique="true"/>
      </column>
      <column  name="WIDGET_TYPE_CD"  type="CHAR(2)">
        <constraints nullable="false" referencedTableName="WIDGET_TYPE" referencedColumnNames="WIDGET_TYPE_CD" foreignKeyName="FK_WIDGET_TYPE_REF_CD"/>
      </column>
      <column  name="ACTION_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="true"/>
      </column>
    </createTable>
    <!-- Attribute Type -->
    <createTable  tableName="ATTRIBUTE_TYPE">
      <column  name="ATTRIBUTE_TYPE_ID"  type="BIGINT">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_ATTRIBUTE_TYPE_ID" unique="true"/>
      </column>
      <column  name="ATTRIBUTE_TYPE_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
      <column  name="ARRAY_IND"  type="CHAR(1)" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
    </createTable>
    <!-- Widget Type Attribute Table -->
    <createTable  tableName="WIDGET_TYPE_ATTRIBUTE">
      <column  name="WIDGET_TYPE_ATTRIBUTE_ID"  type="BIGINT">
        <constraints nullable="false"  primaryKey="true" primaryKeyName="PK_WIDGET_TYPE_ATTRIBUTE" unique="true"/>
      </column>
      <column  name="WIDGET_TYPE_CD"  type="CHAR(2)">
        <constraints nullable="false" referencedTableName="WIDGET_TYPE" referencedColumnNames="WIDGET_TYPE_CD" foreignKeyName="FK_WIDGET_TYPE_REF_CD"/>
      </column>
      <column  name="ATTRIBUTE_TYPE_ID"  type="INT">
        <constraints nullable="false" referencedTableName="ATTRIBUTE_TYPE" referencedColumnNames="ATTRIBUTE_TYPE_ID" foreignKeyName="FK_WIDGET_TYPE_ATT_TYP_ID"/>
      </column>
      <column  name="ATTRIBUTE_NM"  type="VARCHAR(20)" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
      <column  name="REQUIRED_IND"  type="CHAR(1)" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
    </createTable>
    <!-- Widget Type Attribute Generator -->
    <addAutoIncrement tableName="WIDGET_TYPE_ATTRIBUTE" columnName="WIDGET_TYPE_ATTRIBUTE_ID" columnDataType="BIGINT" defaultOnNull="false" generationType="ALWAYS" incrementBy="1" startWith="100"/>


    <!-- This creates the Audit Trail Table. This table is used to track who is changing what, etc -->
    <createTable  tableName="AUDIT_TRAIL">  
      <column  name="AUDIT_TRAIL_ID"  type="BIGINT">  
        <constraints nullable="false"  primaryKey="true"  primaryKeyName="PK_AUDIT_TRAIL_ID" unique="true"/>  
      </column>  
      <column  name="USER_ID"  type="BIGINT" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>  
      </column>  
      <column  name="AUDIT_TYPE"  type="VARCHAR(1)" >  
        <constraints nullable="false"  primaryKey="false"  unique="false"/>  
      </column>  
      <column  name="TARGET_NM"  type="VARCHAR(30)" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
      <column  name="TARGET_ID"  type="BIGINT" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
      <column  name="AUDIT_TS"  type="TIMESTAMP" >
        <constraints nullable="false"  primaryKey="false"  unique="false"/>
      </column>
    </createTable>  
    <!-- This creates the generator for the AUDIT_TRAIL primary key -->
    <addAutoIncrement tableName="AUDIT_TRAIL" columnName="AUDIT_TRAIL_ID" columnDataType="BIGINT" defaultOnNull="false" generationType="ALWAYS" incrementBy="1" startWith="100"/>
    <!-- Add indexes -->
    <createIndex indexName="IDX_AUD_TRL_USER_ID" tableName="AUDIT_TRAIL">
        <column  name="USER_ID"/>
    </createIndex>  
    <createIndex indexName="IDX_AUD_TARGET_ID" tableName="AUDIT_TRAIL">
        <column  name="TARGET_NM"/>
        <column  name="TARGET_ID"/>
        <column  name="USER_ID"/>
    </createIndex>


  </changeSet>  
</databaseChangeLog> 
